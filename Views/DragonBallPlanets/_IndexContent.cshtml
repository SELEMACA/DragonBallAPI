@using DragonBallZ.Models.DTOs
@model PlanetsListVm
@{
    var currentPage = Model?.Page ?? 1;
    var totalPages = Model?.Meta?.TotalPages ?? (Model?.HasNext == true ? currentPage + 1 : currentPage);
    if (totalPages < 1) totalPages = 1;
    var itemsCount = Model?.Items?.Count ?? 0;
    var limitVal = Model?.Limit ?? 10;
}
<div id="indexFragment"
     data-page="@currentPage"
     data-total-pages="@totalPages"
     data-items-count="@itemsCount"
     data-limit="@limitVal">

    <div id="viewCards" class="dbz-grid">
        @foreach (var p in Model.Items)
        {
            var statusText = (p.IsDestroyed == true) ? "Destruido" : "Vigente";
            <article class="dbz-card scouter">
                <a href="@Url.Action("Details", "DragonBallPlanets", new { id = p.Id })" style="text-decoration:none; color:inherit; display:block">
                    <img class="thumb planet-thumb" src="@p.Image" alt="@p.Name" onerror="this.style.display='none'" /> 
                    <div class="body">
                        <div class="name">@p.Name</div>
                        <div style="display:flex; gap:8px; align-items:center; margin-top:4px">
                            <span class="badge-ki">ID @p.Id</span>
                            <span class="@(p.IsDestroyed == true ? "chip bad" : "chip good")">@statusText</span>
                        </div>
                    </div>
                </a>
            </article>
        }
    </div>

    <div id="viewTable" style="display:none;">
        <table class="dbz-table">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nombre</th>
                    <th>Estado</th>
                    <th>Imagen</th>
                    <th>Detalle</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var p in Model.Items)
                {
                    <tr>
                        <td>@p.Id</td>
                        <td>@p.Name</td>
                        <td>@(p.IsDestroyed == true ? "Destruido" : "Vigente")</td>
                        <td>
                            @if (!string.IsNullOrWhiteSpace(p.Image))
                            {
                                <img src="@p.Image" alt="@p.Name" class="table-planet-thumb" onerror="this.style.display='none'" />
                            }
                        </td>
                        <td>
                            <a class="dbz-btn" href="@Url.Action("Details", "DragonBallPlanets", new { id = p.Id })">Ver</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <nav class="mt-3" aria-label="Paginación de planetas" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap">
        @{
            var q = new { name = Model.Name, isDestroyed = Model.IsDestroyed, limit = Model.Limit };
        }
        @if (Model.HasPrev)
        {
            <a class="dbz-btn js-page" href="@Url.Action("Index", new { page = Model.Page - 1, q.name, q.isDestroyed, q.limit })">← Anterior</a>
        }
        else
        {
            <span class="dbz-btn" style="filter:grayscale(.8); cursor:not-allowed; opacity:.6">← Anterior</span>
        }

        <span class="badge-blue">Página @Model.Page</span>

        @if (Model.HasNext)
        {
            <a class="dbz-btn js-page" href="@Url.Action("Index", new { page = Model.Page + 1, q.name, q.isDestroyed, q.limit })">Siguiente →</a>
        }
        else
        {
            <span class="dbz-btn" style="filter:grayscale(.8); cursor:not-allowed; opacity:.6">Siguiente →</span>
        }
    </nav>
</div>
